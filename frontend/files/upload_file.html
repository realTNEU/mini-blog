{% extends 'base.html' %}

{% block title %}Upload File - MiniBlog{% endblock %}

{% block content %}
<!-- Header -->
<div class="mb-8" data-aos="fade-down">
    <h1 class="text-4xl font-bold gradient-text mb-2">Upload File</h1>
    <p class="text-gray-600">Share documents, spreadsheets, images, and more</p>
</div>

<!-- Upload Form -->
<div class="max-w-2xl mx-auto" data-aos="fade-up">
    <form method="post" enctype="multipart/form-data" id="uploadForm" class="glass-effect rounded-2xl p-8 space-y-6">
        {% csrf_token %}
        
        <!-- File Input Area -->
        <div>
            <label for="file" class="block text-lg font-semibold text-gray-800 mb-4">
                <i class="fas fa-file-upload mr-2 text-blue-600"></i>Choose File
            </label>
            
            <!-- Drag and Drop Zone -->
            <div id="dropZone" class="border-3 border-dashed border-gray-300 rounded-2xl p-12 text-center cursor-pointer hover:border-blue-600 hover:bg-blue-50 transition group">
                <input type="file" id="file" name="file" class="hidden" required>
                
                <!-- Default State -->
                <div id="defaultState" class="space-y-3">
                    <div class="flex justify-center">
                        <div class="inline-flex items-center justify-center w-20 h-20 bg-blue-100 rounded-full group-hover:bg-blue-200 transition">
                            <i class="fas fa-cloud-upload-alt text-3xl text-blue-600"></i>
                        </div>
                    </div>
                    <p class="text-xl font-semibold text-gray-800">Drag and drop your file</p>
                    <p class="text-gray-600">or click to browse your files</p>
                    <div style="margin-top: 1rem;">
                        <button
                            type="button"
                            class="btn-secondary-custom"
                            onclick="event.stopPropagation(); document.getElementById('file').click();"
                            aria-label="Browse files to upload"
                        >
                            <i class="fas fa-folder-open mr-2"></i>Browse files
                        </button>
                    </div>
                    <p class="text-sm text-gray-500 mt-2">
                        <i class="fas fa-info-circle mr-1"></i>
                        Excel, CSV, PDF, Images, and more supported
                    </p>
                </div>
                
                <!-- File Selected State -->
                <div id="selectedState" class="hidden space-y-4">
                    <div class="flex justify-center">
                        <div id="fileIcon" class="inline-flex items-center justify-center w-20 h-20 bg-green-100 rounded-full">
                            <i class="fas fa-check text-3xl text-green-600"></i>
                        </div>
                    </div>
                    <div class="text-left bg-white rounded-xl p-4 border border-gray-200">
                        <p class="text-sm text-gray-500 mb-1">File Selected</p>
                        <p id="fileName" class="text-lg font-bold text-gray-900"></p>
                        <p id="fileSize" class="text-sm text-gray-600 mt-1"></p>
                    </div>
                    <button type="button" class="btn-secondary-custom" onclick="event.stopPropagation(); resetFile()">
                        <i class="fas fa-times mr-2"></i>Choose Different File
                    </button>
                </div>
            </div>
            
            <!-- File Info -->
            <div class="mt-4 p-4 bg-blue-50 rounded-xl border border-blue-200">
                <p class="text-sm text-gray-700">
                    <i class="fas fa-lightbulb mr-2 text-blue-600"></i>
                    <strong>Pro Tip:</strong> Excel and CSV files will be automatically analyzed to show row and column counts!
                </p>
            </div>
        </div>
        
        <!-- Form Actions -->
        <div class="flex gap-4 pt-6 border-t border-gray-200">
            <a href="{% url 'files:list_files' %}" class="btn-secondary-custom">
                <i class="fas fa-times mr-2"></i>Cancel
            </a>
            <button type="submit" id="submitBtn" class="btn-primary-custom flex-1 justify-center" disabled>
                <i class="fas fa-check-circle mr-2"></i>Upload File
            </button>
        </div>
    </form>
</div>

<!-- File Type Guide -->
<div class="max-w-2xl mx-auto mt-12 grid md:grid-cols-4 gap-4" data-aos="fade-up" data-aos-delay="200">
    <div class="glass-effect rounded-xl p-4 text-center">
        <div class="text-2xl mb-2"><i class="fas fa-file-excel text-green-600"></i></div>
        <p class="font-semibold text-gray-800 text-sm">Excel</p>
        <p class="text-xs text-gray-600">.xlsx, .xls</p>
    </div>
    
    <div class="glass-effect rounded-xl p-4 text-center">
        <div class="text-2xl mb-2"><i class="fas fa-table text-blue-600"></i></div>
        <p class="font-semibold text-gray-800 text-sm">CSV</p>
        <p class="text-xs text-gray-600">.csv</p>
    </div>
    
    <div class="glass-effect rounded-xl p-4 text-center">
        <div class="text-2xl mb-2"><i class="fas fa-file-pdf text-red-600"></i></div>
        <p class="font-semibold text-gray-800 text-sm">PDF</p>
        <p class="text-xs text-gray-600">.pdf</p>
    </div>
    
    <div class="glass-effect rounded-xl p-4 text-center">
        <div class="text-2xl mb-2"><i class="fas fa-image text-purple-600"></i></div>
        <p class="font-semibold text-gray-800 text-sm">Images</p>
        <p class="text-xs text-gray-600">.jpg, .png, .gif</p>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
function formatBytes(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
}

function getFileIcon(filename) {
    const ext = filename.split('.').pop().toLowerCase();
    const icons = {
        'xlsx': 'fa-file-excel text-green-600',
        'xls': 'fa-file-excel text-green-600',
        'csv': 'fa-table text-blue-600',
        'pdf': 'fa-file-pdf text-red-600',
        'jpg': 'fa-image text-purple-600',
        'jpeg': 'fa-image text-purple-600',
        'png': 'fa-image text-purple-600',
        'gif': 'fa-image text-purple-600',
        'doc': 'fa-file-word text-blue-600',
        'docx': 'fa-file-word text-blue-600',
    };
    return icons[ext] || 'fa-file text-gray-600';
}

function resetFile() {
    document.getElementById('file').value = '';
    $('#defaultState').removeClass('hidden');
    $('#selectedState').addClass('hidden');
    $('#submitBtn').prop('disabled', true);
}

$(document).ready(function() {
    const dropZone = $('#dropZone');
    const fileInput = $('#file');
    
    // Drag and drop events
    dropZone.on('dragover dragenter', function(e) {
        e.preventDefault();
        e.stopPropagation();
        dropZone.addClass('border-blue-600 bg-blue-50');
    });
    
    dropZone.on('dragleave', function(e) {
        e.preventDefault();
        dropZone.removeClass('border-blue-600 bg-blue-50');
    });
    
    dropZone.on('drop', function(e) {
        e.preventDefault();
        e.stopPropagation();
        dropZone.removeClass('border-blue-600 bg-blue-50');
        const files = e.originalEvent.dataTransfer.files;
        if (files.length > 0) {
            fileInput[0].files = files;
            fileInput.trigger('change');
        }
    });
    
    // Click to select
    dropZone.click(function() {
        fileInput.click();
    });
    
    // File selected
    fileInput.on('change', function() {
        if (this.files && this.files[0]) {
            const file = this.files[0];
            $('#fileName').text(file.name);
            $('#fileSize').text(formatBytes(file.size));
            $('#fileIcon').html('<i class="fas ' + getFileIcon(file.name) + ' text-2xl"></i>');
            
            $('#defaultState').addClass('hidden');
            $('#selectedState').removeClass('hidden');
            $('#submitBtn').prop('disabled', false);
        }
    });
    
    // Form submit
    $('#uploadForm').submit(function(e) {
        if (!fileInput[0].files || !fileInput[0].files[0]) {
            e.preventDefault();
            alert('Please select a file');
            return false;
        }
        
        const btn = $('#submitBtn');
        btn.prop('disabled', true).html('<i class="fas fa-spinner fa-spin mr-2"></i>Uploading...');
    });
});
</script>
{% endblock %}
