{% extends 'base.html' %}

{% block title %}Create Post - MiniBlog{% endblock %}

{% block content %}
<div class="create-post-wrapper">
    <div class="create-post-header" data-aos="fade-down">
        <h1 class="create-post-title gradient-text">Create New Post</h1>
        <p class="create-post-subtitle">Share your thoughts and ideas with the world</p>
    </div>

    <form method="post" enctype="multipart/form-data" id="createPostForm" class="create-post-form glass-effect" data-aos="fade-up">
        {% csrf_token %}
        
        <div class="create-post-field">
            <label for="title" class="create-post-label">
                Post Title
            </label>
            <input 
                type="text" 
                id="title" 
                name="title" 
                required
                placeholder="Give your post a compelling title..."
                class="create-post-input"
            >
            <p class="create-post-help">Maximum 200 characters</p>
        </div>
        
        <div class="create-post-field">
            <label for="content" class="create-post-label">
                Content
            </label>
            <textarea 
                id="content" 
                name="content" 
                required
                rows="12"
                placeholder="Write your amazing story here..."
                class="create-post-textarea"
            ></textarea>
            <div class="create-post-footer">
                <p class="create-post-help">Minimum 10 characters</p>
                <div class="create-post-counter">
                    <span id="charCount" class="create-post-count">0</span> characters
                </div>
            </div>
        </div>
        
        <div class="create-post-field">
            <label for="image" class="create-post-label">
                Cover Image (Optional)
            </label>
            <div id="imageDropZone" class="create-post-image-zone">
                <input type="file" id="image" name="image" accept="image/*" class="create-post-input-hidden">
                <div id="imagePreview" class="create-post-image-preview hidden">
                    <img id="previewImg" src="" alt="Preview" class="create-post-preview-img">
                    <button type="button" class="btn-secondary-custom" onclick="event.stopPropagation(); document.getElementById('image').value=''; resetImagePreview()">
                        Remove Image
                    </button>
                </div>
                <div id="uploadPrompt" class="create-post-upload-prompt">
                    <p class="create-post-upload-text">Drag and drop your image here</p>
                    <p class="create-post-upload-hint">or click to browse (JPG, PNG, GIF)</p>
                    <div class="create-post-upload-btn-wrapper">
                        <button
                            type="button"
                            class="btn-secondary-custom"
                            onclick="event.stopPropagation(); document.getElementById('image').click();"
                            aria-label="Browse images"
                        >
                            Browse images
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="create-post-actions">
            <a href="{% url 'posts:list_posts' %}" class="btn-secondary-custom">
                Cancel
            </a>
            <button type="submit" id="submitBtn" class="btn-primary-custom create-post-submit">
                Publish Post
            </button>
        </div>
    </form>

    <div class="create-post-tips" data-aos="fade-up" data-aos-delay="200">
        <div class="create-post-tip glass-effect">
            <h3 class="create-post-tip-title">Be Creative</h3>
            <p class="create-post-tip-text">Share unique perspectives and original ideas</p>
        </div>
        
        <div class="create-post-tip glass-effect">
            <h3 class="create-post-tip-title">Add Images</h3>
            <p class="create-post-tip-text">Cover images make your post stand out</p>
        </div>
        
        <div class="create-post-tip glass-effect">
            <h3 class="create-post-tip-title">Engage</h3>
            <p class="create-post-tip-text">Connect with other writers in the community</p>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    $('#content').on('input', function() {
        $('#charCount').text($(this).val().length);
    });
    
    const dropZone = $('#imageDropZone');
    const imageInput = $('#image');
    
    dropZone.on('dragover dragenter', function(e) {
        e.preventDefault();
        dropZone.addClass('create-post-image-zone-active');
    });
    
    dropZone.on('dragleave drop', function(e) {
        e.preventDefault();
        dropZone.removeClass('create-post-image-zone-active');
    });
    
    dropZone.on('drop', function(e) {
        const files = e.originalEvent.dataTransfer.files;
        if (files.length > 0) {
            imageInput[0].files = files;
            imageInput.trigger('change');
        }
    });
    
    dropZone.click(function() {
        imageInput.click();
    });
    
    imageInput.on('change', function() {
        if (this.files && this.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                $('#previewImg').attr('src', e.target.result);
                $('#imagePreview').removeClass('hidden');
                $('#uploadPrompt').addClass('hidden');
            }
            reader.readAsDataURL(this.files[0]);
        }
    });
    
    $('#createPostForm').submit(function(e) {
        const title = $('#title').val();
        const content = $('#content').val();
        
        if (!title || !content) {
            e.preventDefault();
            alert('Please fill in title and content');
            return false;
        }
        
        const btn = $('#submitBtn');
        btn.prop('disabled', true).html('Publishing...');
    });
});

function resetImagePreview() {
    $('#imagePreview').addClass('hidden');
    $('#uploadPrompt').removeClass('hidden');
}
</script>
{% endblock %}
