{% extends 'base.html' %}

{% block title %}Create Post - MiniBlog{% endblock %}

{% block content %}
<!-- Header -->
<div class="mb-8" data-aos="fade-down">
    <h1 class="text-4xl font-bold gradient-text mb-2">Create New Post</h1>
    <p class="text-gray-600">Share your thoughts and ideas with the world</p>
</div>

<!-- Create Post Form -->
<div class="max-w-3xl mx-auto" data-aos="fade-up">
    <form method="post" enctype="multipart/form-data" id="createPostForm" class="glass-effect rounded-2xl p-8 space-y-6">
        {% csrf_token %}
        
        <!-- Title Field -->
        <div>
            <label for="title" class="block text-lg font-semibold text-gray-800 mb-3">
                <i class="fas fa-heading mr-2 text-blue-600"></i>Post Title
            </label>
            <input 
                type="text" 
                id="title" 
                name="title" 
                required
                placeholder="Give your post a compelling title..."
                class="w-full px-4 py-4 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-blue-600 focus:ring-2 focus:ring-blue-100 transition text-lg font-medium"
            >
            <p class="text-xs text-gray-500 mt-2">Maximum 200 characters</p>
        </div>
        
        <!-- Content Field -->
        <div>
            <label for="content" class="block text-lg font-semibold text-gray-800 mb-3">
                <i class="fas fa-pen-fancy mr-2 text-blue-600"></i>Content
            </label>
            <textarea 
                id="content" 
                name="content" 
                required
                rows="12"
                placeholder="Write your amazing story here... Supports markdown formatting!"
                class="w-full px-4 py-4 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-blue-600 focus:ring-2 focus:ring-blue-100 transition font-sans"
            ></textarea>
            <div class="flex justify-between items-center mt-2">
                <p class="text-xs text-gray-500">Minimum 10 characters</p>
                <div class="text-xs font-semibold text-gray-600">
                    <span id="charCount" class="text-blue-600">0</span> characters
                </div>
            </div>
        </div>
        
        <!-- Image Upload -->
        <div>
            <label for="image" class="block text-lg font-semibold text-gray-800 mb-3">
                <i class="fas fa-image mr-2 text-blue-600"></i>Cover Image (Optional)
            </label>
            <div id="imageDropZone" class="border-2 border-dashed border-gray-300 rounded-xl p-8 text-center cursor-pointer hover:border-blue-600 hover:bg-blue-50 transition">
                <input type="file" id="image" name="image" accept="image/*" class="hidden">
                <div id="imagePreview" class="hidden">
                    <img id="previewImg" src="" alt="Preview" class="max-h-48 mx-auto mb-4 rounded-lg">
                    <button type="button" class="btn-secondary-custom" onclick="event.stopPropagation(); document.getElementById('image').value=''; resetImagePreview()">
                        <i class="fas fa-times mr-2"></i>Remove Image
                    </button>
                </div>
                <div id="uploadPrompt">
                    <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-3"></i>
                    <p class="text-gray-600 font-medium">Drag and drop your image here</p>
                    <p class="text-gray-500 text-sm">or click to browse (JPG, PNG, GIF)</p>
                    <div style="margin-top: 1rem;">
                        <button
                            type="button"
                            class="btn-secondary-custom"
                            onclick="event.stopPropagation(); document.getElementById('image').click();"
                            aria-label="Browse images"
                        >
                            <i class="fas fa-folder-open mr-2"></i>Browse images
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Form Actions -->
        <div class="flex gap-4 pt-6 border-t border-gray-200">
            <a href="{% url 'posts:list_posts' %}" class="btn-secondary-custom">
                <i class="fas fa-times mr-2"></i>Cancel
            </a>
            <button type="submit" id="submitBtn" class="btn-primary-custom flex-1 justify-center">
                <i class="fas fa-paper-plane mr-2"></i>Publish Post
            </button>
        </div>
    </form>
</div>

<!-- Tips Section -->
<div class="max-w-3xl mx-auto mt-12 grid md:grid-cols-3 gap-6" data-aos="fade-up" data-aos-delay="200">
    <div class="glass-effect rounded-xl p-6 text-center">
        <div class="inline-flex items-center justify-center w-12 h-12 bg-blue-100 rounded-full mb-4">
            <i class="fas fa-lightbulb text-blue-600 text-xl"></i>
        </div>
        <h3 class="font-bold text-gray-800 mb-2">Be Creative</h3>
        <p class="text-sm text-gray-600">Share unique perspectives and original ideas</p>
    </div>
    
    <div class="glass-effect rounded-xl p-6 text-center">
        <div class="inline-flex items-center justify-center w-12 h-12 bg-green-100 rounded-full mb-4">
            <i class="fas fa-images text-green-600 text-xl"></i>
        </div>
        <h3 class="font-bold text-gray-800 mb-2">Add Images</h3>
        <p class="text-sm text-gray-600">Cover images make your post stand out</p>
    </div>
    
    <div class="glass-effect rounded-xl p-6 text-center">
        <div class="inline-flex items-center justify-center w-12 h-12 bg-purple-100 rounded-full mb-4">
            <i class="fas fa-star text-purple-600 text-xl"></i>
        </div>
        <h3 class="font-bold text-gray-800 mb-2">Engage</h3>
        <p class="text-sm text-gray-600">Connect with other writers in the community</p>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // Character counter
    $('#content').on('input', function() {
        $('#charCount').text($(this).val().length);
    });
    
    // Image drag and drop
    const dropZone = $('#imageDropZone');
    const imageInput = $('#image');
    
    dropZone.on('dragover dragenter', function(e) {
        e.preventDefault();
        dropZone.addClass('border-blue-600 bg-blue-50');
    });
    
    dropZone.on('dragleave drop', function(e) {
        e.preventDefault();
        dropZone.removeClass('border-blue-600 bg-blue-50');
    });
    
    dropZone.on('drop', function(e) {
        const files = e.originalEvent.dataTransfer.files;
        if (files.length > 0) {
            imageInput[0].files = files;
            imageInput.trigger('change');
        }
    });
    
    dropZone.click(function() {
        imageInput.click();
    });
    
    // Image preview
    imageInput.on('change', function() {
        if (this.files && this.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                $('#previewImg').attr('src', e.target.result);
                $('#imagePreview').removeClass('hidden');
                $('#uploadPrompt').addClass('hidden');
            }
            reader.readAsDataURL(this.files[0]);
        }
    });
    
    // Submit form
    $('#createPostForm').submit(function(e) {
        const title = $('#title').val();
        const content = $('#content').val();
        
        if (!title || !content) {
            e.preventDefault();
            alert('Please fill in title and content');
            return false;
        }
        
        const btn = $('#submitBtn');
        btn.prop('disabled', true).html('<i class="fas fa-spinner fa-spin mr-2"></i>Publishing...');
    });
});

function resetImagePreview() {
    $('#imagePreview').addClass('hidden');
    $('#uploadPrompt').removeClass('hidden');
}
</script>
{% endblock %}
